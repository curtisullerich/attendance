<html>
	<head>
		<script src="script.js">
		</script>
		<script>
		
			/**
			* TODO
			*	chronological and alphabetical sorting of tardy list (radio buttons or value changing button)
			**/
		
			//This prepares the unique tardy ID. If there is no unique tardy ID, it is set to 0.
			//Otherwise, the existing value is preserved
			if(localStorage.getItem("uniqueTardyID") == null)
			{
				localStorage.setItem("uniqueTardyID", 0);
			}
			
			/**
			* This function selects the netID input box by default on pageload
			**/
			window.onload = function(){
				var text_input = document.getElementById ("student");
				text_input.focus ();
				text_input.select ();
			}
			
			/**
			* This function submits a tardy to the local storage based on the netID entered in the input box
			**/
			function submitTardy() {
				//checks for valid ID
				if(!validate())
				{
					//alert for invalid netID
					alert("Please enter a valid netID.");
					return false;
				}
				//format of tardy (24 hour time): netID YYYY-MM-DD hh:mm
				var tardyEntry = document.getElementById("student").value + " " + dateToday() + " " + timeNow();
				storeTardy(tardyEntry);
				retrieveTardies()
				document.getElementById("student").value = "";
				return false;
			}
			
			/**
			* This helper function stores a tardyEntry to the localStorage and increments the unique tardy ID
			**/
			function storeTardy(tardyEntry){
				//stores tardy entry with key: tardyStudent0, tardyStudent1, etc.
				localStorage.setItem(tardyPrepend+localStorage.getItem("uniqueTardyID"),tardyEntry);
				//since all localStorage is entered as a String, parseInt is used to change "0" to 0 so 1 can be added
				localStorage.setItem("uniqueTardyID", parseInt(localStorage.getItem("uniqueTardyID"))+1); 
			}
			
			/**
			* This function shows and hides the tardy list, viewTardiesOn keeps track of whether the tardy list
			* is being shown
			**/
			var viewTardiesOn = false;
			function tardiesOnOff(){
				viewTardiesOn = !viewTardiesOn;
				retrieveTardies();
			}
			
			/**
			* This helper function prints the tardies to the screen in chronologigical order of submission
			* if viewTardiesOn is true;
			**/
			function retrieveTardies(){
				if(viewTardiesOn){
					//array for sorting
					var tardyArray = new Array();
					var tardyArrayIndex = 0;
					var returnString = "<br>The Following Students Reported Being Tardy:</br>";
					//iterates through all entries in localStorage
					for(var i = 0, l = localStorage.length; i<l; i++)
					{
						var key = localStorage.key(i);
						if(stringContains(tardyPrepend,key))
						{
							tardyArray[tardyArrayIndex++] = [key,localStorage.getItem(key)];
						}
					}
					//if people were tardy, sort them and print
					if(tardyArray.length > 0){
						//sort array
						var sortedTardyArray = tardyArray.sort();
						//assign sorted array to String
						for(var i = 0, l = sortedTardyArray.length; i<l; i++)
						{
							var value = sortedTardyArray[i][1];
							returnString += value + "</br>";
						}
						document.getElementById("tardies").innerHTML = returnString;
						//changes button text
						document.getElementById("viewButton").value = "Hide Tardies";
					}
					//if no one was tardy, say so
					else{
						document.getElementById("tardies").innerHTML = "<br>No students were tardy.</br>";
						//changes button text
						document.getElementById("viewButton").value = "Hide Tardies";
					}
				}
				else{
					document.getElementById("tardies").innerHTML = "";
					//changes button text
					document.getElementById("viewButton").value = "View Tardies";
				}
			}
			
			/**
			* This function clears all tardy entries in the localStorage
			**/
			function clearTardies()
			{
				//disable buttons while clearing
				document.getElementById("clear").disabled = true;
				document.getElementById("submit").disabled = true;
				document.getElementById("viewButton").disabled = true;
				document.getElementById("clear").value = "Clearing...";
				//reset unique tardy ID to 0
				localStorage.setItem("uniqueTardyID", 0);
				//iterate through all localStorage entries
				for(var i = 0, l = localStorage.length; i<l; i++)
				{
					var key = localStorage.key(i);
					if(stringContains(tardyPrepend,key))
					{
						localStorage.removeItem(key);
						l--; //accounts for removal of entry in length of localStorage
						i--; //accounts for removal of entry in position of search
					}
				}
				//turn off printed tardy list
				viewTardiesOn = false;
				retrieveTardies();
				//wait .5 second to show disabled buttons in case operation takes very little time
				setTimeout(function(){
					//re-enable buttons
					document.getElementById("clear").disabled = false;
					document.getElementById("submit").disabled = false;
					document.getElementById("viewButton").disabled = false;
					document.getElementById("clear").value = "Clear Tardy List";
				},500);
			}
			
			/**
			* This function check the locally stored copy of the list of students to ensure that the
			* entered netID is valid
			**/
			function validate(){
				//check if the student field is blank
				if(document.getElementById("student").value == "")
					return false;
				else
					return true;
			}
			
		</script>
	</head>
	<body>
	<h1>Marching Band Tardy Check-In</h1>
		<form id="tardyReport" onsubmit="return submitTardy();">netID
            <input type="text" id="student" placeholder="netID"/>
			<input type="submit" id="submit" value="Submit Tardy"/>
        </form>
		
		<input type="submit" id="viewButton" value="View Tardies" onclick="javascript: tardiesOnOff();"></input>
		<input type="submit" id="clear" value="Clear Tardy List" onclick="javascript: clearTardies();"></input>
		
		<div></br></div>
		<input type="submit" id="back" value="Back to Main Page" onclick="parent.location='FieldAppMain.html'"></input></br>

		<div id="tardies"></div>
	</body>
</html>