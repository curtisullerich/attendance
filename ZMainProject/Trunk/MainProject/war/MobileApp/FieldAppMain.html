<html> <!-- manifest="FieldAppCache.appcache" -->

<!-- UPDATE THE APPCACHE WHENEVER CHANGES ARE MADE!!! -->

	<head>
		<title>@10dance Mobile App</title>
		<link rel="stylesheet" type="text/css" href="FieldAppCSS.css"></link>
		<script src="script.js"></script>
		<script src="sha.js"></script>
		<script>
			
			/**
			 *
			 *
			 *
			 *
			 *
			 */
			window.onload = function() {
				var array = storeToArray(studentPrepend," ","date");
				var str;
				if (array.length < 1) {
					str="No class list is currently present.";
				} else {
					str="Current class list: " + array[0][0];
				}
				document.getElementById("classList").innerHTML = str;
			   
					
				if(localStorage.getItem("success") == "true"){
					//clear all absence and tardy data
					clearLocalStoragewithPrepend(absentPrependPerformance);
					clearLocalStoragewithPrepend(absentPrependRehearsal);
					clearLocalStoragewithPrepend(rehearsalPrepend);
					clearLocalStoragewithPrepend(performancePrepend);
					clearLocalStoragewithPrepend(tardyPrepend);
					alert("Absence Data Successfully Uploaded and Locally Removed");
					
					localStorage.removeItem("success");
				}
				else if(!localStorage.getItem("success") == "false"){
					alert("Absence Data Upload Unsuccessful - Local Data Was Not Changed");
					localStorage.removeItem("success");
				}
				else if(localStorage.getItem("success") == "emptyString")
				{
					alert("Nothing was uploaded to the server")
					localStorage.removeItem("success");
				}
			   
				if(debug){
					document.getElementById("clear").hidden = false;
				}
			}
						
	        /**
			 *
			 *
			 *
			 *
			 *
			 */
	        function updateList() {
	
	            if (!navigator.onLine) {
	               alert("You're not online. Update not performed.");
	               return false;
	            }
	               uncacheClassList();
	               window.location = "http://localhost:8888/JSPPages/updateList.jsp";
	        }
	
	        /**
			 *
			 *
			 *
			 *
			 *
			 */
	        function uploadAll() {
				if (!navigator.onLine) {
				   alert("You're not online. Upload not performed.");
				   return false;
				}
	
				var str = "";
				var key;
				for (var i = 0; i < localStorage.length; i++) {
					key = localStorage.key(i);
					if(!stringContains(studentPrepend,key) && !stringContains(loginPrepend,key)){
						str += key + ",";
					}
				}
				document.getElementById("tempForUpload").value = str;
				
				//alert(str);
				//the server will remove the text from the div once successful			 
	        }
	        
	        /**
	         * Removes all student records currently stored in localStorage
	         *
	         * @author Curtis Ullerich
	         * @date 3/3/12
	         */
	        function uncacheClassList() {
	            clearLocalStoragewithPrepend(studentPrepend);
	        }
			
	        /**
			 *
			 *
			 *
			 *
			 *
			 */
			function clearAll(){
	        	if(debug){
					document.getElementById("clear").disabled = true;
					document.getElementById("tardy").disabled = true;
					document.getElementById("absent").disabled = true;
					document.getElementById("update").disabled = true;
					document.getElementById("submit").disabled = true;
					document.getElementById("clear").value = "Clearing...";
					localStorage.clear();
					setTimeout(function(){
						//re-enable buttons
						document.getElementById("clear").disabled = false;
						document.getElementById("tardy").disabled = false;
						document.getElementById("absent").disabled = false;
						document.getElementById("update").disabled = false;
						document.getElementById("submit").disabled = false;
						document.getElementById("clear").value = "Clear ALL THE THINGS!!!";
						window.location.reload();
					},1000);
	        	}
			}
	        
			/**
			 *
			 *
			 *
			 *
			 *
			 */
	        function help(){
	            alert("This page is the start page for the @10dance Mobile App.\n"+
	            "\nClicking the Update Class List button updates the class list from the server."+
	            "\n\nThe Tardy Check-In button navigates to the tardy check-in page."+
	            "\n\nThe Report Absences button navigates to the absence reporting page."+
	            "\n\nThe Upload Attendance Data button uploads the attendance data to the server."+
	            "Upon successful upload, the local attendance data is cleared."+
	            "\n\nBoth reporting absences and uploading attendance data require valid TA login info.");
	            return false;
	        }
			
		</script>
	</head>
	<body>
		<div class="box">
			<h1>@10dance</h1>
			</br>
			<input class="help" type="button" id="help" value="Help" onclick="javascript: help();"/>
			<form method="POST" action="/JSPPages/uploadr.jsp" class="centeralign">
				<input class="button" type="button" id="tardy" value="Tardy Check-In" onclick="parent.location='FieldAppTardy.html'"/> 
				<input class="button" type="button" id="absent" value="Report Absences" onclick="parent.location = 'FieldAppAbsent.html'"/>
				<div>
					</br>
				</div>
				<input class="button" type="button" id="update" value="Update Class List" onclick="javascript: updateList();"/>
				<input class="button" type="submit" id="submit" value="Upload Attendance Data" onclick="uploadAll();"/> 
				<input type="hidden" id="tempForUpload" name="tempForUpload" value=""/>
				<div>
					</br>
				</div>
			</form>
			<div id="classList" class="centeralign">Latest Class List: None</div>
			</br>
			<div class="centeralign">
				<input class="button" type="button" id="clear" value="Clear ALL THE THINGS!!!" onClick="clearAll();" hidden=true/>
			</div>
		</div>
	</body>
</html>
