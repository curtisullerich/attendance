<html> <!-- manifest="FieldAppCache.appcache" -->
	<head>	
		<title>@10dance Tardy Check-In</title>
		<link rel="stylesheet" type="text/css" href="FieldAppCSS.css">
		<script src="script.js"></script>
		<script>
			
			//global variable to determine if tardy list is shown
			var viewTardiesOn = false;
		
			/**
			 * This function selects the netID input box by default and 
			 * makes the clear butten visible if debug is true on pageload
			 *
			 * @author Todd Wegter
			 * @date 3-23-2012
			 */
			window.onload = function(){
				if(debug){
					document.getElementById("clear").hidden = false;
				}
				
				var text_input = document.getElementById ("student");
				text_input.focus ();
				text_input.select ();
			}
			
			/**
			 * This function selects the netID input box by default when called
			 *
			 * @author Todd Wegter
			 * @date 2-10-212
			 */
			function netIDSelect(){
				var text_input = document.getElementById ("student");
				text_input.focus ();
				text_input.select ();
			}
			
			/**
			 * This function submits a tardy to the local storage based on the netID entered in the input box
			 *
			 * @returns False (otherwise onsubmit calls to this function refresh the page, which is not desired)
			 * @author Todd Wegter
			 * @date 2-10-2012
			 */
			function submitTardy() {
				//checks for valid ID
				var netID = document.getElementById("student").value;
				if(!validate(netID))
				{
					netIDSelect();
					return false;
				}
				//format of tardy (24 hour time): "netID YYYY-MM-DD HH:MMam/pm
				var tardyEntry = getFirstName(netID) + " " + getLastName(netID) + " " + dateToday() + " " + twelveHourTimeNow();
				//store tardy with appropriate key
				storeEntry(tardyPrepend, getFirstName(netID), getLastName(netID), netID, dateToday(), timeNow(), "|", getRank(netID), tardyEntry);
				document.getElementById("student").value = "";
				//updates onscreen tardy list if necessary
				retrieveTardies();
				//autoplace cursor in netID box
				netIDSelect();
				return false;
			}
			
			/**
			 * This function shows and hides the tardy list, viewTardiesOn keeps track of whether the tardy list
			 * is being shown
			 *
			 * @author Todd Wegter
			 * @date 2-27-2012
			 */
			function tardiesOnOff(){
				viewTardiesOn = !viewTardiesOn;
				retrieveTardies();
			}
//Continue here!!!!!		
			/**
			 * If viewTardiesOn is true, calls printTardies and determines the order for the printed tardies (selected with radio buttons).
			 * Otherwise it clears the table
			 *
			 * @author Todd Wegter
			 */
			function retrieveTardies(){
				if(viewTardiesOn){
					var sortType;
					var sortRadio = document.getElementById("tardySortType").elements;
					//sort chronologically or by netID based on radio buttons
					if (sortRadio[0].checked == 1) {
						sortType = "starttime";
					} else {
						sortType = "netID";
					}
					printTardies(sortType);
				}
				else{
					document.getElementById("tardies").innerHTML = "";
					//clear existing table
					var table = document.getElementById("tardyTable");
					for(var i = table.rows.length - 1; i >= 0; i--)
					{
						table.deleteRow(i);
					}
					//changes button text
					document.getElementById("viewButton").value = "View Tardies";
				}
			}
			
			
			/**
			 * Inserts the absences currently stored into localStorage into
			 * tardyTable.
			 * 
			 * @author Todd Wegter
			 * @date 3/23/12
			 */
			function printTardies(sortType) {
				//clear existing table
				var table = document.getElementById("tardyTable");
				for(var i = table.rows.length - 1; i >= 0; i--)
				{
					table.deleteRow(i);
				}
				
				var array = storeToArray(tardyPrepend, dateToday(), sortType);
				if(array.length > 0){
					array.sort();
					document.getElementById("tardies").innerHTML = "<br>The Following Students Reported Being Tardy:</br></br>";
					for (var i = 0; i < array.length; i++) {
						addRowToTable("0",array[i][1]);
					}
				}
				else{
					document.getElementById("tardies").innerHTML = "<br>No students were tardy.</br>";
				}
				document.getElementById("viewButton").value = "Hide Tardies";
			}
			
			/**
			* This function clears all tardy entries in the localStorage
			*
			* @author Todd Wegter
			**/
			function clearTardies()
			{
				if(debug)
				{
					//disable buttons while clearing
					document.getElementById("clear").disabled = true;
					document.getElementById("student").disabled = true;
					document.getElementById("submit").disabled = true;
					document.getElementById("viewButton").disabled = true;
					document.getElementById("back").disabled = true;
					document.getElementById("re-sort").disabled = true;
					document.getElementById("clear").value = "Clearing...";
					//clear all tardy records
					clearLocalStoragewithPrepend(tardyPrepend);
					//turn off printed tardy list
					viewTardiesOn = false;
					retrieveTardies();
					//wait .5 second to show disabled buttons in case operation takes very little time
					setTimeout(function(){
						//re-enable buttons
						document.getElementById("clear").disabled = false;
						document.getElementById("submit").disabled = false;
						document.getElementById("viewButton").disabled = false;
						document.getElementById("back").disabled = false;
						document.getElementById("re-sort").disabled = false;
						document.getElementById("student").disabled = false;
						document.getElementById("clear").value = "Clear Tardy List";
					},1000);
					netIDSelect();
				}
			}
			
			/**
			* This function check the locally stored copy of the list of students to ensure that the
			* entered netID is valid
			*
			* @author Todd Wegter
			**/
			function validate(netID){
				//check if the student field is blank
				if(netID != "" || netID != null){
					//alert for invalid netID
					if(localStorageContainsStudent(netID))
					{
						netIDSelect();
						return true;
					}
				}
				alert("Please enter a valid netID.");
				document.getElementById("student").placeholder = "netID";
				netIDSelect();
				return false;
			}
			
			function help(){
				alert("This page is the tardy check-in page for the @10dance Mobile App.\n"+
				"\nValid netIDs may be entered to mark a student as tardy."+
				"\n\nClicking View Tardies will show the recorded tardies."+
				"\n\nThe Re-Sort Tardy List button allows the user to resort the tardy entries by either time or netID.");
				return false;
			}
			
		</script>
	
	<body>
		<div class="box">
			<h1>Tardy Check-In</h1></br>
				<form class="centeralign" id="tardyReport" onsubmit="return submitTardy();">
					<input type="text" id="student" placeholder="netID">
					<input type="submit" id="submit" value="Submit Tardy">
				</form>
				
				</br>
				<hr>
				</br>
				
				<form class="centeralign" id="tardyView">
					<input type="button" id="viewButton" value="View Tardies" onclick="javascript: tardiesOnOff();"/>
					<input type="button" id="re-sort" value="Re-Sort Tardy List" onclick="javascript: retrieveTardies();"/>
					<input type="button" id="clear" value="Clear Tardy List" onclick="javascript: clearTardies();" hidden=true/>
					<br>
				</form>
				
				<form class="centeralign" id="tardySortType">
					<b>Sort Style</b>
					<input type="radio" name="sortType" value="Time" checked=""/>time
					<input type="radio" name="sortType" value="netID"/>netID<br>
				</form>
				
				<div id="tardies"></div>
				<Table id="tardyTable" class="table"> <!-- table 0 -->
					<tbody>
					</tbody>
				</Table>
				
				<input class="back" type="button" id="back" value="Back" onclick="parent.location='FieldAppMain.html'"/><br>
				<input class="help" type="button" id="help" value="Help" onclick="javascript: help();"/>
			</div>
	</body>
</html>
